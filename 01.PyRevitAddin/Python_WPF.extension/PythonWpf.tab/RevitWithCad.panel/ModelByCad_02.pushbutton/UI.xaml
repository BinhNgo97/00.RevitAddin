<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:av="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="av"
        Title="Model By CAD" Width="1400" Height="780"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="#1C2A33">

    <Window.Resources>
        <!-- ── Button styles ── -->
        <Style x:Key="BtnOrange" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#FF9800"/>
            <Setter Property="Foreground" Value="#1C2A33"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="3,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F57C00"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#E65100"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="BtnGreen" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="#1C2A33"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="3,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#388E3C"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="BtnCyan" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#00BCD4"/>
            <Setter Property="Foreground" Value="#1C2A33"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="3,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#0097A7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="BtnRed" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#E53935"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="3,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#C62828"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="BtnGray" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#546E7A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="3,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#37474F"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ── Shared DataGrid styles ── -->
        <Style x:Key="DgColHeader" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Background" Value="#37474F"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="4,3"/>
            <Setter Property="BorderBrush" Value="#546E7A"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="DgRow" TargetType="{x:Type DataGridRow}">
            <Setter Property="Background" Value="#263238"/>
            <Setter Property="Foreground" Value="#ECEFF1"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#00838F"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#37474F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ── Panel label style ── -->
        <Style x:Key="PanelTitle" TargetType="{x:Type TextBlock}">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#80DEEA"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,4,0,4"/>
            <Setter Property="TextDecorations" Value="Underline"/>
        </Style>

        <Style x:Key="FieldLabel" TargetType="{x:Type TextBlock}">
            <Setter Property="Foreground" Value="#B0BEC5"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="2,2,6,2"/>
        </Style>
    </Window.Resources>

    <Grid Margin="6">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Row 0: Top buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Row 1: Status bar -->
            <RowDefinition Height="*"/>
            <!-- Row 2: Main content -->
            <RowDefinition Height="30"/>
            <!-- Row 3: Condition action bar -->
            <RowDefinition Height="180"/>
            <!-- Row 5: Bảng 3 -->
        </Grid.RowDefinitions>

        <!-- ══════════════════════════════════════════════════
             Row 0 – Top Buttons
        ══════════════════════════════════════════════════ -->
        <WrapPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
            <Button x:Name="BtnLoadFile" Content="Load File CAD" Style="{StaticResource BtnOrange}" MinWidth="120"/>
            <Border Background="#0D1F29" BorderBrush="#546E7A" BorderThickness="1"
                    CornerRadius="8" Padding="6,3" Margin="3,0" VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Grid Layer:" Foreground="#80CBC4" FontSize="11"
                               VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="TxtGridLayer" Width="120"
                             Text="{Binding CadGridLayer, UpdateSourceTrigger=PropertyChanged}"
                             Background="Transparent" Foreground="#ECEFF1" BorderThickness="0"
                             Padding="2,1" FontSize="11" VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
            <Separator Width="20" Background="Transparent"/>
            <Button x:Name="BtnDelete"      Content="Delete Selected" Style="{StaticResource BtnRed}"  MinWidth="130"/>
            <Button x:Name="BtnRefresh"     Content="↺ Refresh"       Style="{StaticResource BtnGray}" MinWidth="90"/>
        </WrapPanel>

        <!-- ══════════════════════════════════════════════════
             Row 1 – Status bar
        ══════════════════════════════════════════════════ -->
        <Border Grid.Row="1" Background="#0D1F29" CornerRadius="4"
                Padding="8,3" Margin="0,0,0,5">
            <TextBlock x:Name="TxtStatus" Text="{Binding Status}"
                       Foreground="#80CBC4" FontSize="11" TextWrapping="NoWrap"/>
        </Border>

        <!-- ══════════════════════════════════════════════════
             Row 2 – Main Content: Left | Middle | Right
        ══════════════════════════════════════════════════ -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="310"/>
                <!-- Left: Bảng 1 + Bảng 2 -->
                <ColumnDefinition Width="5"/>
                <!-- Splitter -->
                <ColumnDefinition Width="270"/>
                <!-- Middle: Set up data type -->
                <ColumnDefinition Width="5"/>
                <!-- Splitter -->
                <ColumnDefinition Width="*"/>
                <!-- Right: Canvas -->
            </Grid.ColumnDefinitions>

            <!-- ── LEFT: Bảng 1 + Bảng 2 ── -->
            <Border Grid.Column="0" Background="#0D1F29" BorderBrush="#37474F"
                    BorderThickness="1" CornerRadius="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- Row 0: Title + Insert/Remove/Update -->
                        <RowDefinition Height="Auto"/>
                        <!-- Row 1: Form fields -->
                        <RowDefinition Height="Auto"/>
                        <!-- Row 2: Add Rule / Del Rule -->
                        <RowDefinition Height="Auto"/>
                        <!-- Row 3: Divider -->
                        <RowDefinition Height="*"/>
                        <!-- Row 4: DgRules -->
                    </Grid.RowDefinitions>

                    <!-- Row 0: Title only -->
                    <TextBlock Grid.Row="0" Text="Condition Setup"
                               Style="{StaticResource PanelTitle}"
                               Margin="6,6,6,2"/>

                    <!-- Row 1: Form fields -->
                    <Grid Grid.Row="1" Margin="6,4,6,4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Condition Name -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Condition Name" Style="{StaticResource FieldLabel}"/>
                        <TextBox   Grid.Row="0" Grid.Column="1"
                                   Text="{Binding CondName, UpdateSourceTrigger=PropertyChanged}"
                                   Background="#263238" Foreground="#ECEFF1" BorderBrush="#546E7A"
                                   Padding="4,3" Margin="0,2" FontSize="11"/>

                        <!-- File Name -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="File Name" Style="{StaticResource FieldLabel}"/>
                        <ComboBox  Grid.Row="1" Grid.Column="1"
                                   x:Name="CbCondFile"
                                   SelectedItem="{Binding CondFile, UpdateSourceTrigger=PropertyChanged}"
                                   ItemsSource="{Binding LoadedFileNames}"
                                   Background="#263238" Foreground="Black" BorderBrush="#546E7A"
                                   Padding="4,2" Margin="0,2" FontSize="11">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="{x:Type ComboBoxItem}">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="Background" Value="White"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                        </ComboBox>

                        <!-- Category -->
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Category" Style="{StaticResource FieldLabel}"/>
                        <ComboBox  Grid.Row="2" Grid.Column="1"
                                   SelectedItem="{Binding CondCategory, UpdateSourceTrigger=PropertyChanged}"
                                   ItemsSource="{Binding Categories}"
                                   Background="#263238" Foreground="Black" BorderBrush="#546E7A"
                                   Padding="4,2" Margin="0,2" FontSize="11">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="{x:Type ComboBoxItem}">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="Background" Value="White"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                        </ComboBox>
                    </Grid>

                    <!-- Row 2: Add Rule / Del Rule -->
                    <WrapPanel Grid.Row="2" Margin="6,2,6,4">
                        <Button x:Name="BtnInsertCondition" Content="Insert"
                            Style="{StaticResource BtnOrange}" MinWidth="60" FontSize="11" Padding="8,4" Width="90"/>
                        <Button x:Name="BtnAddRule"    Content="Add Rule" Style="{StaticResource BtnGreen}" MinWidth="72" FontSize="11" Width="94"/>
                        <Button x:Name="BtnRemoveRule" Content="Del Rule" Style="{StaticResource BtnRed}"   MinWidth="68" FontSize="11" Width="93"/>
                    </WrapPanel>

                    <!-- Row 3: Divider -->
                    <Border Grid.Row="3" Height="1" Background="#37474F" Margin="6,0"/>

                    <!-- Row 4: Filter Rules title + DataGrid -->
                    <Grid Grid.Row="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Style="{StaticResource PanelTitle}" Text="Filter Rules (OR logic)"/>

                        <DataGrid x:Name="DgRules"
                                  Grid.Row="1"
                                  ItemsSource="{Binding CurrentRules}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False" CanUserDeleteRows="False"
                                  CanUserReorderColumns="False" CanUserSortColumns="False"
                                  SelectionMode="Single" SelectionUnit="FullRow"
                                  RowHeaderWidth="0"
                                  Background="#0D1F29" Foreground="#ECEFF1"
                                  GridLinesVisibility="Horizontal"
                                  HorizontalGridLinesBrush="#37474F"
                                  BorderThickness="0"
                                  ColumnHeaderStyle="{StaticResource DgColHeader}"
                                  RowStyle="{StaticResource DgRow}">
                            <DataGrid.Columns>

                                <!-- Parameter -->
                                <DataGridTemplateColumn Header="Parameter" Width="90">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Parameter}" Padding="4,3"
                                                       VerticalAlignment="Center" FontSize="11"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox SelectedItem="{Binding Parameter, UpdateSourceTrigger=PropertyChanged}"
                                                      ItemsSource="{Binding PARAMETERS}"
                                                      FontSize="11"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Ruler -->
                                <DataGridTemplateColumn Header="Ruler" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Ruler}" Padding="4,3"
                                                       VerticalAlignment="Center" FontSize="11"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox SelectedItem="{Binding Ruler, UpdateSourceTrigger=PropertyChanged}"
                                                      ItemsSource="{Binding AvailableRulers}"
                                                      FontSize="11"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Value – ComboBox editable (layer dropdown hoặc number input) -->
                                <DataGridTemplateColumn Header="Value" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Value}" Padding="4,3"
                                                       Foreground="#FFD54F"
                                                       VerticalAlignment="Center" FontSize="11"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox IsEditable="True"
                                                      Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                      ItemsSource="{Binding DataContext.AvailableLayers, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                                      FontSize="11"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>

                </Grid>
            </Border>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                          Background="#37474F" VerticalAlignment="Stretch"/>

            <!-- ── MIDDLE: Set up data type ── -->
            <Border Grid.Column="2" Background="#0D1F29" BorderBrush="#37474F"
                    BorderThickness="1" CornerRadius="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Style="{StaticResource PanelTitle}" Text="Set up data type"/>

                    <DataGrid x:Name="DgGroups"
                              Grid.Row="1"
                              ItemsSource="{Binding PreviewGroups}"
                              SelectedItem="{Binding SelectedGroup, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False" CanUserDeleteRows="False"
                              CanUserReorderColumns="False" CanUserSortColumns="False"
                              SelectionMode="Single" SelectionUnit="FullRow"
                              RowHeaderWidth="0"
                              Background="#0D1F29" Foreground="#ECEFF1"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#37474F"
                              BorderThickness="0"
                              ColumnHeaderStyle="{StaticResource DgColHeader}"
                              RowStyle="{StaticResource DgRow}">
                        <DataGrid.Columns>

                            <!-- Qty -->
                            <DataGridTextColumn Header="Qty" Binding="{Binding Count}"
                                               IsReadOnly="True" Width="38">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Padding" Value="3,3"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="Foreground" Value="#FFD54F"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- Data From Cad -->
                            <DataGridTextColumn Header="Data From Cad" Binding="{Binding Label}"
                                               IsReadOnly="True" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Padding" Value="4,3"/>
                                        <Setter Property="Foreground" Value="#00E5FF"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="FontSize" Value="11"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- Family Type -->
                            <DataGridTemplateColumn Header="Family Type" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding FamilyType}" Padding="4,3"
                                                   FontSize="11" VerticalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox SelectedItem="{Binding FamilyType, UpdateSourceTrigger=PropertyChanged}"
                                                  ItemsSource="{Binding FilteredFamilyTypes}"
                                                  IsEditable="False" FontSize="11"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch"
                          Background="#37474F" VerticalAlignment="Stretch"/>

            <!-- ── RIGHT: Canvas Preview ── -->
            <Border Grid.Column="4" Background="#0D1F29" BorderBrush="#37474F"
                    BorderThickness="1" CornerRadius="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Style="{StaticResource PanelTitle}" Text="Preview"/>

                    <!-- ── Fixed Beam Info Panel (Row 1) ── -->
                    <Border Grid.Row="1"
                            Background="#122736" BorderBrush="#00E5FF" BorderThickness="0,0,0,1"
                            Padding="10,6" Visibility="{Binding BeamInfoVisible}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                       Text="{Binding SelectedBeamInfo.BeamLabel}"
                                       Foreground="#00E5FF" FontWeight="Bold" FontSize="11"
                                       VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <TextBlock Grid.Column="1"
                                       Text="Location Type :"
                                       Foreground="#80CBC4" FontSize="11"
                                       VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <ComboBox  Grid.Column="2"
                                       SelectedItem="{Binding SelectedBeamInfo.LocationType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       ItemsSource="{Binding SelectedBeamInfo.LOCATION_TYPES}"
                                       Foreground="Black" FontSize="11"/>
                            <TextBlock Grid.Column="3"
                                       Text="Family Type :"
                                       Foreground="#80CBC4" FontSize="11"
                                       VerticalAlignment="Center" Margin="12,0,6,0"/>
                            <ComboBox  Grid.Column="4"
                                       SelectedItem="{Binding SelectedBeamInfo.FamilyType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       ItemsSource="{Binding SelectedBeamInfo.FilteredFamilyTypes}"
                                       Foreground="Black" FontSize="11"/>
                        </Grid>
                    </Border>

                    <Canvas x:Name="DrawingCanvas" Grid.Row="2"
                            Background="Transparent" ClipToBounds="True" Cursor="Hand"/>
                </Grid>
            </Border>
        </Grid>

        <!-- ══════════════════════════════════════════════════
             Row 3 – Condition action bar (Insert / Remove / Update)
        ══════════════════════════════════════════════════ -->
        <WrapPanel Grid.Row="3" Orientation="Horizontal"
                   HorizontalAlignment="Left" Margin="0,4,0,4" Width="309">
            <Button x:Name="BtnRemoveCondition" Content="Remove"
                    Style="{StaticResource BtnRed}"    MinWidth="60" FontSize="11" Padding="8,4" Width="151"/>
            <Button x:Name="BtnUpdateCond"      Content="Update"
                    Style="{StaticResource BtnCyan}"   MinWidth="60" FontSize="11" Padding="8,4" Width="146"/>
        </WrapPanel>

        <!-- Splitter giữa action bar và Bảng 3 -->
        <GridSplitter Grid.Row="4" Height="5" HorizontalAlignment="Stretch"
                      Background="#37474F" VerticalAlignment="Stretch"/>

        <!-- ══════════════════════════════════════════════════
             Row 5 – Bảng 3 (full width)
        ══════════════════════════════════════════════════ -->
        <Border Grid.Row="5" Background="#0D1F29" BorderBrush="#37474F"
                BorderThickness="1" CornerRadius="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Bảng 3 header: "Conditions" centered -->
                <TextBlock Grid.Row="0" Text="Conditions"
                           Style="{StaticResource PanelTitle}"
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Margin="0,4,0,2"/>

                <DataGrid x:Name="DgConditions"
                          Grid.Row="1"
                          ItemsSource="{Binding Conditions}"
                          SelectedItem="{Binding SelectedCondition, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False" CanUserDeleteRows="False"
                          CanUserReorderColumns="False" CanUserSortColumns="False"
                          SelectionMode="Single" SelectionUnit="FullRow"
                          RowHeaderWidth="0"
                          Background="#0D1F29" Foreground="#ECEFF1"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="#37474F"
                          BorderThickness="0"
                          ColumnHeaderStyle="{StaticResource DgColHeader}"
                          RowStyle="{StaticResource DgRow}">
                    <DataGrid.Columns>

                        <!-- Condition Name -->
                        <DataGridTextColumn Header="Condition Name"
                                           Binding="{Binding ConditionName}"
                                           IsReadOnly="True" Width="130">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="Padding" Value="5,4"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="#ECEFF1"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- File Name -->
                        <DataGridTextColumn Header="File Name"
                                           Binding="{Binding FileName}"
                                           IsReadOnly="True" Width="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="Padding" Value="4,4"/>
                                    <Setter Property="Foreground" Value="#B0BEC5"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Categories -->
                        <DataGridTextColumn Header="Categories"
                                           Binding="{Binding Category}"
                                           IsReadOnly="True" Width="145">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="Padding" Value="4,4"/>
                                    <Setter Property="Foreground" Value="#80DEEA"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Analysis – button: click = run analysis, text = x / v -->
                        <DataGridTemplateColumn Header="Analysis" Width="72">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button x:Name="BtnAnalysis"
                                            Content="{Binding AnalysisStatus}"
                                            Tag="{Binding}"
                                            Margin="4,2" Padding="4,2" FontSize="12"
                                            FontWeight="Bold" Cursor="Hand"
                                            HorizontalAlignment="Center"
                                            BorderThickness="0">
                                        <Button.Style>
                                            <Style TargetType="{x:Type Button}">
                                                <Setter Property="Background" Value="#546E7A"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding AnalysisDone}" Value="True">
                                                        <Setter Property="Background" Value="#2E7D32"/>
                                                        <Setter Property="Foreground" Value="#A5D6A7"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- AxisAlign – trạng thái snap tọa độ về lưới -->
                        <DataGridTemplateColumn Header="AxisAlign" Width="90">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding AxisAlignLabel}"
                                               Padding="4,4" FontSize="11"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="{x:Type TextBlock}">
                                                <Setter Property="Foreground" Value="#546E7A"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding AxisAlignDone}" Value="True">
                                                        <Setter Property="Foreground" Value="#A5D6A7"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding AxisAlignStatus}" Value="!">
                                                        <Setter Property="Foreground" Value="#FFD54F"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Preview – CheckBox (enable chỉ khi AnalysisDone) -->
                        <DataGridTemplateColumn Header="Preview" Width="65">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding PreviewChecked, UpdateSourceTrigger=PropertyChanged}"
                                              IsEnabled="{Binding CanPreview}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              Margin="4,0"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Line in Revit – button per row -->
                        <DataGridTemplateColumn Header="Line in Revit" Width="95">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding RevitLineLabel}"
                                            Tag="{Binding}"
                                            Margin="4,2" Padding="4,2" FontSize="11"
                                            FontWeight="Bold" Cursor="Hand"
                                            HorizontalAlignment="Center"
                                            BorderThickness="0">
                                        <Button.Style>
                                            <Style TargetType="{x:Type Button}">
                                                <Setter Property="Background" Value="#FF9800"/>
                                                <Setter Property="Foreground" Value="#1C2A33"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RevitLineRef, Converter={x:Null}}" Value="{x:Null}"/>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Create Model – button per row -->
                        <DataGridTemplateColumn Header="Create Model" Width="105">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding CreateModelLabel}"
                                            Tag="{Binding}"
                                            Margin="4,2" Padding="4,2" FontSize="11"
                                            FontWeight="Bold" Cursor="Hand"
                                            HorizontalAlignment="Center"
                                            BorderThickness="0">
                                        <Button.Style>
                                            <Style TargetType="{x:Type Button}">
                                                <Setter Property="Background" Value="#00BCD4"/>
                                                <Setter Property="Foreground" Value="#1C2A33"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CreateModelDone}" Value="True">
                                                        <Setter Property="Background" Value="#2E7D32"/>
                                                        <Setter Property="Foreground" Value="#A5D6A7"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding is_ready}" Value="False">
                                                        <Setter Property="Opacity" Value="0.45"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Base Level – ComboBox per row -->
                        <DataGridTemplateColumn Header="Base Level" Width="110">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding BaseLevel}"
                                               Padding="4,4" FontSize="11"
                                               Foreground="#A5D6A7"
                                               VerticalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <ComboBox SelectedItem="{Binding BaseLevel, UpdateSourceTrigger=PropertyChanged}"
                                              ItemsSource="{Binding DataContext.Levels, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                              IsEditable="False" FontSize="11"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

    </Grid>
</Window>
